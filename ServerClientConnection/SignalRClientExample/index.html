<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Client Example</title>
  </head>
  <body>
    <input id="message" type="text" placeholder="Enter a message" />
    <button id="send">Send</button>

    <div></div>
    <script src="signalr.min.js"></script>
    <script src="jquery.min.js"></script>
    <script>
      const serverAddr = "https://localhost:5001";
      $(() => {
        const conn = new signalR.HubConnectionBuilder()
          .withUrl(`${serverAddr}/myhub`)
          // .withAutomaticReconnect()
          // connection kesilerse -> 0 - 2 - 10 - 30 sn baghlanmagha chalishacaq
          // -> end connecting attempt
          .withAutomaticReconnect([1000, 1000, 2000, 3000, 5000, 10000])
          // baghlanti var lakin kesildiyi anlarda istifade olunur
          .build();

        conn.on("receiveMessage", (msg) => {
          $("div").append(`<p>${msg}</p>`);
        });

        // conn.start();
        start();

        // baghlanti hech qurulmadigh anlarda bu funksiya istifade olunur
        async function start() {
          try {
            await conn.start();
          } catch (error) {
            setTimeout(() => {
              start();
            }, 2000);
          }
        }

        $("#send").click(() => {
          const message = $("#message").val();

          conn
            .invoke("SendMessageAsync", message)
            .catch((error) => console.log(`Error: ${error}`));
        });
      });
    </script>
  </body>
</html>
